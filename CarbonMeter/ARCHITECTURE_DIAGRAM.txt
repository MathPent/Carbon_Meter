# ğŸ—ï¸ CarbonMeter ML Integration Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         CARBONMETER SYSTEM                              â”‚
â”‚                  ML-Powered Missing Day Prediction                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              FRONTEND LAYER                             â”‚
â”‚                         React (Port 3000)                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                      DashboardPage.jsx                         â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚    â”‚
â”‚  â”‚  â”‚         Data Toggle Filters                           â”‚    â”‚    â”‚
â”‚  â”‚  â”‚  [ ğŸ“Š Real Data Only ]  [ ğŸ¤– Include Predicted ]    â”‚    â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚    â”‚
â”‚  â”‚                                                               â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚    â”‚
â”‚  â”‚  â”‚          PredictionCard Component                     â”‚    â”‚    â”‚
â”‚  â”‚  â”‚                                                        â”‚    â”‚    â”‚
â”‚  â”‚  â”‚  ğŸ“… Missing Days (Last 30 days)                      â”‚    â”‚    â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚    â”‚    â”‚
â”‚  â”‚  â”‚  â”‚ Jan 27, 2026    [ Predict ]             â”‚         â”‚    â”‚    â”‚
â”‚  â”‚  â”‚  â”‚ Jan 25, 2026    [ Predict ]             â”‚         â”‚    â”‚    â”‚
â”‚  â”‚  â”‚  â”‚ Jan 22, 2026    [ Predict ]             â”‚         â”‚    â”‚    â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚    â”‚    â”‚
â”‚  â”‚  â”‚                                                        â”‚    â”‚    â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚    â”‚    â”‚
â”‚  â”‚  â”‚  â”‚  ğŸ¤– Prediction Result                    â”‚         â”‚    â”‚    â”‚
â”‚  â”‚  â”‚  â”‚  Date: Jan 27, 2026                      â”‚         â”‚    â”‚    â”‚
â”‚  â”‚  â”‚  â”‚  Predicted: 4.73 kg COâ‚‚                  â”‚         â”‚    â”‚    â”‚
â”‚  â”‚  â”‚  â”‚  Confidence: âœ… High (90%)               â”‚         â”‚    â”‚    â”‚
â”‚  â”‚  â”‚  â”‚  Based on: 15 days of history            â”‚         â”‚    â”‚    â”‚
â”‚  â”‚  â”‚  â”‚                                          â”‚         â”‚    â”‚    â”‚
â”‚  â”‚  â”‚  â”‚  [Cancel]  [âœ“ Confirm & Save]           â”‚         â”‚    â”‚    â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚    â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                         â”‚
â”‚  API Service (api.js):                                                 â”‚
â”‚  â€¢ predictionAPI.getMissingDays()                                     â”‚
â”‚  â€¢ predictionAPI.predictMissingDay(date)                              â”‚
â”‚  â€¢ predictionAPI.confirmPrediction(data)                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â”‚ HTTPS (JWT Auth)
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           BACKEND LAYER                                 â”‚
â”‚                      Node.js + Express (Port 5000)                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚  ğŸ“¡ Prediction Routes (prediction.js):                                 â”‚
â”‚                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚ GET /api/prediction/missing-days                             â”‚      â”‚
â”‚  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€   â”‚      â”‚
â”‚  â”‚ 1. Query MongoDB for last 30 days                           â”‚      â”‚
â”‚  â”‚ 2. Find dates without activities                            â”‚      â”‚
â”‚  â”‚ 3. Return list of missing dates                             â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚ POST /api/prediction/predict-missing-day                    â”‚      â”‚
â”‚  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€   â”‚      â”‚
â”‚  â”‚ 1. Fetch user's last 20 days emissions (MongoDB)           â”‚      â”‚
â”‚  â”‚ 2. Aggregate daily totals                                   â”‚      â”‚
â”‚  â”‚ 3. Call Python ML API â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚      â”‚
â”‚  â”‚ 4. Return prediction to frontend        â”‚                  â”‚      â”‚
â”‚  â”‚ 5. If ML API fails â†’ use average        â”‚                  â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚                                             â”‚                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚ POST /api/prediction/confirm            â”‚                   â”‚      â”‚
â”‚  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚      â”‚
â”‚  â”‚ 1. Validate user confirmation           â”‚                   â”‚      â”‚
â”‚  â”‚ 2. Create Activity with:                â”‚                   â”‚      â”‚
â”‚  â”‚    â€¢ logType: 'ML Predicted'            â”‚                   â”‚      â”‚
â”‚  â”‚    â€¢ metadata.isPredicted: true         â”‚                   â”‚      â”‚
â”‚  â”‚    â€¢ metadata.confidence: 0.86          â”‚                   â”‚      â”‚
â”‚  â”‚ 3. Save to MongoDB                      â”‚                   â”‚      â”‚
â”‚  â”‚ 4. Update dashboard stats               â”‚                   â”‚      â”‚
â”‚  â”‚ 5. Trigger badge checks                 â”‚                   â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚      â”‚
â”‚                                                                 â”‚      â”‚
â”‚  ğŸ“Š Activities Routes (activities.js):                         â”‚      â”‚
â”‚                                                                 â”‚      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚ GET /api/activities/user-stats?includePredicted=true/false  â”‚      â”‚
â”‚  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€   â”‚      â”‚
â”‚  â”‚ 1. Build query filter based on includePredicted            â”‚      â”‚
â”‚  â”‚ 2. Exclude/Include 'ML Predicted' activities               â”‚      â”‚
â”‚  â”‚ 3. Calculate totals, breakdowns                            â”‚      â”‚
â”‚  â”‚ 4. Return filtered statistics                              â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                            â”‚                                    â”‚
                            â”‚                                    â”‚
                 HTTP POST  â”‚                                    â”‚ Query/Insert
                            â–¼                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      PYTHON ML API LAYER              â”‚    â”‚      DATABASE LAYER          â”‚
â”‚      Flask (Port 8000)                â”‚    â”‚      MongoDB Atlas           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                       â”‚    â”‚                              â”‚
â”‚  ğŸ Endpoints (api.py):               â”‚    â”‚  ğŸ“¦ Collections:             â”‚
â”‚                                       â”‚    â”‚                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ GET /health                     â”‚ â”‚    â”‚  â”‚ users                  â”‚ â”‚
â”‚  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€   â”‚ â”‚    â”‚  â”‚ â€¢ _id, email, role     â”‚ â”‚
â”‚  â”‚ Returns:                        â”‚ â”‚    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚  â”‚ â€¢ status: "running"             â”‚ â”‚    â”‚                              â”‚
â”‚  â”‚ â€¢ model_loaded: true/false      â”‚ â”‚    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ â€¢ port: 8000                    â”‚ â”‚    â”‚  â”‚ activities             â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚    â”‚  â”‚ â€¢ userId               â”‚ â”‚
â”‚                                       â”‚    â”‚  â”‚ â€¢ category             â”‚ â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚    â”‚  â”‚ â€¢ logType â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”¼â”€ 'ML Predicted'
â”‚  â”‚ POST /predict/missing-day       â”‚ â”‚    â”‚  â”‚ â€¢ carbonEmission       â”‚ â”‚
â”‚  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€   â”‚ â”‚    â”‚  â”‚ â€¢ date                 â”‚ â”‚
â”‚  â”‚ Input:                          â”‚ â”‚    â”‚  â”‚ â€¢ metadata:            â”‚ â”‚
â”‚  â”‚ {                               â”‚ â”‚    â”‚  â”‚   - isPredicted        â”‚ â”‚
â”‚  â”‚   emission_history: [4.5, 5.2...] â”‚    â”‚  â”‚   - confidence         â”‚ â”‚
â”‚  â”‚   userId: "123"                 â”‚ â”‚    â”‚  â”‚   - predictionDate     â”‚ â”‚
â”‚  â”‚ }                               â”‚ â”‚    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚  â”‚                                 â”‚ â”‚    â”‚                              â”‚
â”‚  â”‚ Process:                        â”‚ â”‚    â”‚  Query Filters:              â”‚
â”‚  â”‚ 1. Load XGBoost model â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”¼â”€â”€â”€â”€â”¼â”€ â€¢ logType: {$ne: 'ML       â”‚
â”‚  â”‚ 2. Validate input               â”‚ â”‚    â”‚     Predicted'}              â”‚
â”‚  â”‚ 3. Reshape to model format      â”‚ â”‚    â”‚   (For real data only)       â”‚
â”‚  â”‚ 4. Predict emission             â”‚ â”‚    â”‚                              â”‚
â”‚  â”‚ 5. Calculate confidence         â”‚ â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚  â”‚ 6. Return result                â”‚ â”‚
â”‚  â”‚                                 â”‚ â”‚
â”‚  â”‚ Output:                         â”‚ â”‚
â”‚  â”‚ {                               â”‚ â”‚
â”‚  â”‚   predicted_co2: 4.73,          â”‚ â”‚
â”‚  â”‚   confidence: 0.86,             â”‚ â”‚
â”‚  â”‚   demo: false,                  â”‚ â”‚
â”‚  â”‚   days_used: 15                 â”‚ â”‚
â”‚  â”‚ }                               â”‚ â”‚
â”‚  â”‚                                 â”‚ â”‚
â”‚  â”‚ Fallback (if model fails):      â”‚ â”‚
â”‚  â”‚ {                               â”‚ â”‚
â”‚  â”‚   predicted_co2: 3.8,           â”‚ â”‚
â”‚  â”‚   confidence: 0.75,             â”‚ â”‚
â”‚  â”‚   demo: true                    â”‚ â”‚
â”‚  â”‚ }                               â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                       â”‚
â”‚  ğŸ“ Model File:                       â”‚
â”‚  carbonmeter_behavioral_model.pkl     â”‚
â”‚  â€¢ XGBoost trained model              â”‚
â”‚  â€¢ Loaded with absolute path          â”‚
â”‚  â€¢ Fallback if missing                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                            DATA FLOW DIAGRAM
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

User Action: "Click Predict on Missing Date"
    â”‚
    â”œâ”€â–º [1] Frontend â†’ predictionAPI.predictMissingDay("2026-01-27")
    â”‚       â”‚
    â”‚       â”œâ”€â–º [2] Backend â†’ GET user's last 20 days from MongoDB
    â”‚       â”‚       â”‚
    â”‚       â”‚       â””â”€â–º MongoDB: Aggregate daily totals
    â”‚       â”‚           Returns: [4.5, 5.2, 3.8, 6.1, 4.9, ...]
    â”‚       â”‚
    â”‚       â”œâ”€â–º [3] Backend â†’ POST to Python ML API
    â”‚       â”‚       â”‚   Body: { emission_history: [4.5, 5.2, ...] }
    â”‚       â”‚       â”‚
    â”‚       â”‚       â”œâ”€â–º [4] Python ML â†’ Load XGBoost model
    â”‚       â”‚       â”œâ”€â–º [5] Python ML â†’ Predict emission
    â”‚       â”‚       â””â”€â–º [6] Python ML â†’ Calculate confidence
    â”‚       â”‚           Returns: { predicted_co2: 4.73, confidence: 0.86 }
    â”‚       â”‚
    â”‚       â””â”€â–º [7] Backend â†’ Format & return to frontend
    â”‚           Returns: { success: true, predicted_co2: 4.73, ... }
    â”‚
    â””â”€â–º [8] Frontend â†’ Display prediction with confidence badge

User Action: "Click Confirm & Save"
    â”‚
    â”œâ”€â–º [9] Frontend â†’ predictionAPI.confirmPrediction(data)
    â”‚       â”‚
    â”‚       â”œâ”€â–º [10] Backend â†’ Create Activity document
    â”‚       â”‚        {
    â”‚       â”‚          logType: 'ML Predicted',
    â”‚       â”‚          carbonEmission: 4.73,
    â”‚       â”‚          metadata: { isPredicted: true, confidence: 0.86 }
    â”‚       â”‚        }
    â”‚       â”‚
    â”‚       â”œâ”€â–º [11] Backend â†’ Save to MongoDB
    â”‚       â””â”€â–º [12] Backend â†’ Return success
    â”‚
    â””â”€â–º [13] Frontend â†’ Reload dashboard with updated data


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                          FILTER TOGGLE FLOW
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

User clicks "Real Data Only":
    â”‚
    â”œâ”€â–º Frontend â†’ Set includePredicted = false
    â””â”€â–º API Call â†’ /api/activities/user-stats?includePredicted=false
            â”‚
            â””â”€â–º Backend â†’ Query: { userId, logType: { $ne: 'ML Predicted' } }
                    â”‚
                    â””â”€â–º Returns stats WITHOUT predicted activities

User clicks "Include Predicted":
    â”‚
    â”œâ”€â–º Frontend â†’ Set includePredicted = true
    â””â”€â–º API Call â†’ /api/activities/user-stats?includePredicted=true
            â”‚
            â””â”€â–º Backend â†’ Query: { userId }
                    â”‚
                    â””â”€â–º Returns stats WITH predicted activities


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                          ERROR HANDLING FLOW
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Scenario 1: Python ML API Down
    Backend calls ML API â†’ Timeout/Error
    â”‚
    â””â”€â–º Backend catches error
        â””â”€â–º Calculate average of recent emissions
            â””â”€â–º Return fallback: { predicted_co2: 5.2, confidence: 0.75, demo: true }
                â””â”€â–º Frontend shows "Demo Mode" badge

Scenario 2: Model File Missing
    Python API starts without model
    â”‚
    â””â”€â–º model = None
        â””â”€â–º All predictions use fallback values
            â””â”€â–º Returns: { predicted_co2: 3.8, confidence: 0.75, demo: true }

Scenario 3: Insufficient Historical Data
    User has < 5 days of activities
    â”‚
    â””â”€â–º Python API returns fallback
        â””â”€â–º { predicted_co2: 3.5, confidence: 0.65, demo: true }
            â””â”€â–º User can still confirm and save


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                         CONFIDENCE CALCULATION
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Python ML API:
    â”œâ”€ If emission_history.length >= 15  â†’ confidence = 0.90 (High)
    â”œâ”€ If emission_history.length >= 10  â†’ confidence = 0.82 (Medium)
    â”œâ”€ If emission_history.length >= 7   â†’ confidence = 0.75 (Medium)
    â””â”€ If emission_history.length < 7    â†’ confidence = 0.65 (Low)

Frontend Display:
    â”œâ”€ confidence >= 0.85  â†’ âœ… High Confidence (Green)
    â”œâ”€ confidence >= 0.70  â†’ ğŸ“Š Medium Confidence (Blue)
    â””â”€ confidence < 0.70   â†’ âš ï¸ Low Confidence (Yellow)


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                           KEY FEATURES
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

âœ… ML Prediction      - XGBoost model predicts missing daily emissions
âœ… Behavioral Analysis - Analyzes 10-20 days of user activity patterns
âœ… Confidence Scoring  - Based on data quality (more data = higher confidence)
âœ… Smart Fallback      - Works even if ML service is down
âœ… User Confirmation   - Never auto-saves, requires explicit approval
âœ… Clear Labeling      - All predictions marked as "ML Predicted"
âœ… Data Transparency   - Filter toggles to show/hide predictions
âœ… Error Handling      - Graceful degradation at all levels
âœ… Demo Mode           - Visual indicator when using fallback
âœ… MongoDB Integration - Proper schema with metadata


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Architecture Version: 1.0
Last Updated: January 29, 2026
Status: Production Ready âœ…
```
